# Redis Configuration File for Secure Production Setup

# ============================== SECURITY ==============================

# Require a password for all connections
# For production: Use a strong password (generate with: openssl rand -hex 32)
# This password must match the REDIS_PASSWORD in docker-compose.yml
requirepass changeme

# Disable dangerous commands in production
rename-command FLUSHDB ""
rename-command FLUSHALL ""
rename-command CONFIG "CONFIG_abc123def456"

# ============================== PERSISTENCE ==============================

# Enable AOF (Append-Only File) for better data durability
appendonly yes

# AOF filename
appendfilename "appendonly.aof"

# fsync policy - balance between durability and performance
# - always: fsync after every write (slowest, most durable)
# - everysec: fsync once per second (default, good balance)
# - no: let OS decide when to fsync (fastest, less durable)
appendfsync everysec

# Auto rewrite AOF when it reaches 100MB or 100% of its size at last rewrite
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 104857600

# ============================== GENERAL ==============================

# Accept connections from all interfaces (required for Docker)
bind 0.0.0.0

# TCP port
port 6379

# Set the number of databases
databases 16

# Timeout for idle clients (in seconds)
timeout 0

# ============================== MEMORY MANAGEMENT ==============================

# Max memory Redis can use
# For Docker, set based on your container memory limit
# E.g., 512mb for small deployments
maxmemory 512mb

# Memory eviction policy when max memory is reached
# - noeviction: return error when max memory is reached (default)
# - allkeys-lru: remove any key according to LRU algorithm
# - volatile-lru: remove keys with TTL set, LRU algorithm
maxmemory-policy allkeys-lru

# ============================== LOGGING ==============================

# Log level: debug, verbose, notice, warning
loglevel notice

# ============================== REPLICATION ==============================

# Make this instance read-only (for replicas)
# replica-read-only yes

# ============================== CLIENT OUTPUT BUFFER LIMITS ==============================

# Prevent clients from consuming too much memory
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit replica 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60
